<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="theme-color" content="#A7D8F9">
    <link rel="manifest" href="manifest.json">

    <title>MedQuest: Nivel MÃ©dico</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="style.css">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
    <div class="container">
        
        <section id="auth-section" class="auth-section card">
            <h1 class="title">MedQuest</h1>
            <input type="email" id="auth-email" placeholder="Email">
            <input type="password" id="auth-password" placeholder="ContraseÃ±a">
            <div class="auth-buttons">
                <button id="login-btn">Iniciar SesiÃ³n</button>
                <button id="signup-btn">Registrarse</button>
            </div>
            <p id="auth-message"></p>
        </section>

        <main id="app-section" class="app-section" style="display: none;">
            
            <div class="page-container">
                
                <div id="page-home" class="page-content active">
                    <header class="page-header">
                        <h1>Registrar Estudio</h1>
                        <button id="logout-btn">Cerrar SesiÃ³n</button>
                    </header>
                    <section class="card player-info-small">
                        <span id="player-level" class="level-number">Nvl 1</span>
                        
                        <div class="bars-container" style="flex: 1; display: flex; flex-direction: column; gap: 5px;">
                            
                            <div class="xp-bar-container">
                                <div class="xp-bar-fill" id="xp-bar-fill"></div>
                                <span id="xp-text" class="xp-text">0/100 XP</span>
                            </div>
                            
                            <div class="sinapsis-bar-container" style="height: 12px;">
                                <div class="sinapsis-bar-fill" id="sinapsis-bar-fill-home"></div> 
                                <span id="sinapsis-bar-text-home" class="materia-xp-text" style="line-height: 12px; font-size: 0.65em;">0/60 min ğŸ§¬</span>
                            </div>

                        </div>
                    </section>
                    <section class="card log-study-form">
                        <h2>Â¿QuÃ© estudiaste?</h2>
                        <label for="select-materia">Materia</label>
                        <select id="select-materia">
                            <option value="">-- Elige una materia --</option>
                        </select>
                        <label for="select-tema">Tema</label>
                        <select id="select-tema" disabled>
                            <option value="">-- Primero elige una materia --</option>
                        </select>
                        <div class="input-group">
                            <div>
                                <label for="log-minutes">Minutos</label>
                                <input type="number" id="log-minutes" placeholder="ej. 30">
                            </div>
                            <div>
                                <label for="log-study-type">Tipo</label>
                                <select id="log-study-type">
                                    <option value="">-- Elige un tipo --</option>
                                    <option value="Anki">Anki</option>
                                    <option value="Video">Video</option>
                                    <option value="Libro">Libro</option>
                                    <option value="Clase/Audio">Clase / Audio</option>
                                    <option value="Resumen/Apunte">Resumen / Apunte</option>
                                    <option value="Otro">Otro</option>
                                </select>
                            </div>
                        </div>
                        <button id="log-study-btn" class="btn-save">Â¡Registrar SesiÃ³n!</button>
                    </section>
                    <section class="activity-section">
                        <h2>Actividad Reciente</h2>
                        <ul id="recent-activity-list" class="activity-list">
                            </ul>
                    </section>
                </div>

                <div id="page-skills" class="page-content">
                    <header class="page-header">
                        <h1>ğŸŒ³ Skill Tree</h1>
                        <button id="show-add-materia-btn" class="btn-add">+</button>
                    </header>
                    <div id="materias-list-container"></div>
                </div>

                <div id="page-temas" class="page-content">
                    <header class="page-header">
                        <button id="back-to-materias-btn" class="btn-back">â†</button>
                        <h1 id="temas-page-title">Temas</h1>
                        <button id="show-add-tema-btn" class="btn-add">+</button>
                    </header>
                    <div id="temas-list-container"></div>
                </div>

                <div id="page-store" class="page-content">
                    <header class="page-header">
                        <h1>ğŸ›’ Tienda de Buffs</h1>
                    </header>

                    <section class="card sinapsis-display-card">
                        <span class="sinapsis-value" id="sinapsis-count-display">0</span>
                        <span class="stat-label">Sinapsis (ğŸ§¬)</span>
                        
                        <div class="sinapsis-bar-container">
                            <div class="sinapsis-bar-fill" id="sinapsis-bar-fill"></div>
                            <span id="sinapsis-bar-text" class="materia-xp-text">0/60 min para 1 ğŸ§¬</span>
                        </div>
                    </section>
                    
                    <section class="card">
                        <h2>Items</h2>
                        <div id="store-items-container" class="store-grid">
                            </div>
                    </section>
                </div>


                <div id="page-profile" class="page-content">
                    <header class="page-header">
                        <h1>ğŸ† Perfil y Trofeos</h1>
                    </header>
                    <section class="stats-section card">
                        <h2>EstadÃ­sticas</h2>
                        <div class="stat-grid">
                            <div class="stat-card">
                                <span class="stat-value" id="total-minutes-display">0</span>
                                <span class="stat-label">Minutos Totales</span>
                            </div>
                            <div class="stat-card"> 
                                <span class="stat-value" id="total-sessions-display">0</span>
                                <span class="stat-label">Sesiones Totales</span>
                            </div>
                            <div class="stat-card"> 
                                <span class="stat-value streak" id="streak-display">ğŸ”¥ 0</span>
                                <span class="stat-label">DÃ­as de Racha</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <span class="stat-label">Minutos por Tipo de Estudio</span>
                            <div class="chart-container">
                                <canvas id="study-type-chart"></canvas>
                            </div>
                        </div>
                        <div class="stat-card">
                            <span class="stat-label">Minutos por Materia</span>
                            <div class="chart-container">
                                <canvas id="materia-minutes-chart"></canvas>
                            </div>
                        </div>
                        <div class="stat-card">
                            <span class="stat-label">Minutos por Hora del DÃ­a</span>
                            <div class="chart-container-bar">
                                <canvas id="study-hour-chart"></canvas>
                            </div>
                        </div>
                    </section>
                    <section class="trophies-section card">
                        <h2>Mis Trofeos</h2>
                        <div id="trophy-display">
                            </div>
                    </section>
                </div>

                <div id="page-jefes" class="page-content">
                    <section class="boss-section">
                        <header class="page-header" style="margin-bottom: 10px;">
                            <h2>Jefes de Nivel âš”ï¸</h2>
                            <button id="show-add-jefe-btn" class="btn-add">+</button>
                        </header>
                        <div id="jefes-list-container">
                            </div>
                    </section>
                </div>
            </div> 

            <nav class="bottom-nav">
                <button id="nav-home" class="nav-button active">
                    <span>ğŸ </span> <span>Home</span>
                </button>
                <button id="nav-skills" class="nav-button">
                    <span>ğŸŒ³</span> <span>Habilidades</span>
                </button>
                <button id="nav-jefes" class="nav-button">
                    <span>âš”ï¸</span> <span>Jefes</span>
                </button>
                <button id="nav-store" class="nav-button">
                    <span>ğŸ›’</span> <span>Tienda</span>
                </button>
                <button id="nav-profile" class="nav-button">
                    <span>ğŸ†</span> <span>Perfil</span>
                </button>
            </nav>
        </main> 
        
    </div> <div class="modal" id="level-up-modal">
        <div class="modal-content card">
            <span class="close-button">&times;</span>
            <h2>Â¡FELICIDADES!</h2>
            <h3>Â¡Has subido al <span id="modal-new-level"></span>!</h3>
            <p>Â¡Ahora eres un <span id="modal-new-title"></span>!</p>
            <button class="close-button-main">Continuar</button>
        </div>
    </div>
    
    <div class="modal" id="add-materia-modal">
        <div class="modal-content card">
            <span class="close-button">&times;</span>
            <h2>AÃ±adir Nueva Materia</h2>
            <input type="text" id="new-materia-name" placeholder="Ej. FisiologÃ­a II">
            <button id="save-materia-btn" class="btn-save">Guardar</button>
        </div>
    </div>
    
    <div class="modal" id="add-tema-modal">
        <div class="modal-content card">
            <span class="close-button">&times;</span>
            <h2>AÃ±adir Nuevo Tema</h2>
            <input type="text" id="new-tema-name" placeholder="Ej. â¤ï¸ Cardio">
            <input type="number" id="new-tema-goal" placeholder="XP para dominar (ej. 100)">
            <button id="save-tema-btn" class="btn-save">Guardar</button>
        </div>
    </div>
    
    <div class="modal" id="trophy-details-modal">
        <div class="modal-content card trophy-modal-content">
            <span class="close-button">&times;</span>
            <span id="trophy-modal-icon"></span>
            <h2 id="trophy-modal-name"></h2>
            <p id="trophy-modal-desc"></p>
            <span id="trophy-modal-status" class="trophy-status-locked">BLOQUEADO</span>
        </div>
    </div>
    
    <div class="modal" id="badge-unlocked-modal">
        <div class="modal-content card badge-modal-content">
            <span class="close-button">&times;</span>
            <h2>Â¡Badge Desbloqueado!</h2>
            <span id="badge-modal-icon"></span>
            <h3 id="badge-modal-name"></h3>
            <button class="close-button-main">Â¡Genial!</button>
        </div>
    </div>

    <div class="modal" id="buy-modal">
        <div class="modal-content card">
            <span class="close-button">&times;</span>
            <h2 id="buy-modal-title"></h2>
            <p id="buy-modal-message"></p>
            <div id="buy-materia-select-container" style="display:none;">
                <label for="buy-materia-select">Elegir Materia:</label>
                <select id="buy-materia-select"></select>
            </div>
            <button id="confirm-buy-btn" class="btn-save" style="margin-top: 15px;">Confirmar Compra</button>
        </div>
    </div>

    <div class="modal" id="add-jefe-modal">
        <div class="modal-content card">
            <span class="close-button">&times;</span>
            <h2>Programar Jefe de Nivel</h2>
            <label for="new-jefe-name">Nombre del Jefe (Examen)</label>
            <input type="text" id="new-jefe-name" placeholder="Ej. Parcial de FÃ¡rmaco">
            <label for="select-jefe-materia">Materia (para 1.25x XP)</label>
            <select id="select-jefe-materia">
                <option value="">-- Elige una materia --</option>
            </select>
            <label for="new-jefe-date">Fecha del Examen</label>
            <input type="date" id="new-jefe-date">
            <label for="new-jefe-hp">Vida del Jefe (HP)</label>
            <input type="number" id="new-jefe-hp" placeholder="ej. 300 (minutos de estudio)">
            <button id="save-jefe-btn" class="btn-save">Â¡Programar!</button>
        </div>
    </div>

    <div class="modal" id="crisis-mode-modal">
        <div class="modal-content card crisis-modal-content">
            <span class="close-button">&times;</span>
            <h2>ğŸš¨ Â¡MODO CRISIS! ğŸš¨</h2>
            <span id="crisis-modal-icon">âš”ï¸</span>
            <p id="crisis-modal-desc">Â¡Uno de tus Jefes es en 7 dÃ­as o menos! Estudiar su materia te darÃ¡ <strong>1.25x XP</strong>. Â¡Ã‰nfasis 6,5!</p>
            <button class="close-button-main">Â¡Entendido!</button>
        </div>
    </div>

    <div class="modal" id="damage-toast">
        <div class="modal-content card damage-toast-content">
            <span id="damage-toast-text">Â¡+10 de daÃ±o a [Jefe]!</span>
        </div>
    </div>

    <div class="modal" id="confirm-ko-modal">
        <div class="modal-content card confirm-ko-content">
            <h2>ğŸ’¥ Â¿Golpe Final? ğŸ’¥</h2>
            <p id="confirm-ko-text">Â¿EstÃ¡s segura de que quieres dar el GOLPE FINAL al Jefe "[JefeName]"?</p>
            <div class="modal-buttons">
                <button id="confirm-ko-btn-cancel" class="btn-cancel">Cancelar</button>
                <button id="confirm-ko-btn-confirm" class="btn-save">Â¡K.O.!</button>
            </div>
        </div>
    </div>

    <div class="modal" id="alert-modal">
        <div class="modal-content card alert-modal-content">
            <span class="close-button">&times;</span>
            <h2 id="alert-modal-title"></h2>
            <span id="alert-modal-icon"></span>
            <p id="alert-modal-message"></p>
            <button class="close-button-main">Entendido</button>
        </div>
    </div>

    <div class="modal" id="damage-hit-modal">
        <span id="damage-hit-text">-30 HP!</span>
    </div>

    <script src="script.js"></script>
    
</body>
</html>